<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <title>Tag Mining</title>
</head>
<body>
  <div class="container">
    <div class="jumbotron" style="background-color: #e3f2fd;">
      <h1 class="display-3">Tag Mining</h1>
      <p class="lead">Choose the right <strong>#hashtag</strong> and get more likes.</p>
      <!-- <hr class="my-4"> -->
      <div id="login">
        <p>This helps you in choosing a hashtag. So please log in with instagram.</p>
        <p class="lead">
          <a class="btn btn-outline-primary btn-lg"
             href="https://api.instagram.com/oauth/authorize/?client_id=f0a1bf10ef474369bd513e2f888b7377&redirect_uri=http://localhost:8000/&scope=public_content&response_type=token"
             role="button">
             Login
          </a>
        </p>
      </div>
    </div>
    <div id="logon" style="display: none;">
      <div class="row">
        <div class="col-lg-4 col-md-6 offset-md-6 offset-lg-8 mb-3">
          <form class="form-inline">
            <input class="form-control mr-sm-2" type="text" id="search" placeholder="Search Hashtag">
            <button class="btn btn-outline-primary my-2 my-sm-0" onclick="tagSearch()">Search</button>
          </form>
        </div>
      </div>
      <h4 class="card-title">Relevant Hashtag</h4>
      <hr class="my-4">
      <div id="alertInfo" class="alert alert-info" role="alert">
        <strong>#Hashtag</strong> is Not Found!
      </div>
      <div class="row">
        <div class="col-4">
          <ul id="tagList" class="list-group"></ul>
        </div>
      </div>
    </div>
  </div>
  <script>
      var urlApi;
      var tag;
      var hashTag = [];
      if(window.location.hash) {
          var hash = window.location.hash.substring(14); //Puts hash in variable, and removes the # character
          // hash found
        }

        function tagSearch() {
          $('#alertInfo').hide();
          tag = document.getElementById("search").value;
          urlApi = "https://api.instagram.com/v1/tags/"+tag+"/media/recent?access_token="+hash;
          instaApi();
        }

        function instaApi() {
          $.ajax({
            type: "GET",
            dataType: "jsonp",
            cache: true,
            url: urlApi,
            success: function(data) {
              // storeData(data);
              for (var i = 0; i < data.data.length; i++) {
                hashTag.push({
                        id : data.data[i].id,
                        tag : data.data[i].tags
                      });
              }
              // console.log(hashTag);

              urlApi = data.pagination.next_url;
              if (urlApi != undefined) {
                instaApi();
              } else {
                // tagList(hashTag);
                console.log(hashTag);
                // sendData(hashTag); <-- ini fungsi ngirim data ke php ------------------------------------------[]
              }
            }
          });
        }

        function sendData(hashTag) {
          $.ajax({
                  type: "POST",
                  dataType: "json",
                  url: "api/endpoints/tags.php",
                  data: {myData: JSON.stringify(hashTag)},
                  success: function(data){
                      alert('Items added');
                  },
                  error: function(e){
                      console.log(e.message);
                  }
          });
        }

        function tagList(data) {
          console.log("ini buat list");
          for (var i = 0; i < data.length; i++) {
            var li = document.createElement("LI");
            var sp = document.createElement("span");
            var ts = document.createTextNode(data[i].total);
            var tl = document.createTextNode(data[i].name);
            li.className = "list-group-item justify-content-between";
            sp.className = "badge badge-pill badge-info";
            sp.appendChild(ts);
            li.appendChild(tl);
            li.appendChild(sp);
            document.getElementById("tagList").appendChild(li);
          }
          // for (var i = 0; i < data.length; i++) {
          //   for (var j = 0; j < data[i].tag.length; j++) {
          //     var li = document.createElement("LI");
          //     var tl = document.createTextNode(data[i].tag[j]);
          //     li.className = "list-group-item justify-content-between";
          //     li.appendChild(tl);
          //     document.getElementById("tagList").appendChild(li);
          //   }
          // }
        }

        if (hash != null) {
          $('#logon').show();
          $('#login').hide();
          // document.getElementById("login").style.display = "none";
          // document.getElementById("logon").style.display = "block";
        }
  </script>
</body>
</html>
